---
title: "Reproducible Research - Peer Assessment2"
author: "robertwcw"
date: "9/21/2020"
output: 
  html_document: 
    fig_caption: yes
    keep_md: yes
---
## SYNOPSIS

Natural disaster triggered by storms and abnormal weather phenomenons may lead to public health issues and dire economic consequences. The extent, severity, and impact of injuries/fatalities and economic losses are largely determined by the amount of energy unleashed by the types of events in the weather related disasters. This data analysis attempts to address the concerns **WHERE** the events took place and **WHEN** the disasters struck by **WHAT** types of events give rise to deleterious social impact aftermath with respect to economic and public health. Base on the US National Oceanic and Atmospheric Administration (NOAA) storm database, this project makes use of relevant metrics of the number of human injuries/fatalities, financial losses in properties/crops damages in relation to events types across the US from year 1950 to year 2011.  
&nbsp;

#### Set up R workspace environment
```{r setup, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)
Sys.setenv(TZ = "UTC")      # set global TZ to UTC for POSIXt class

.Rfliburl <- "https://raw.githubusercontent.com/robertwcw/Rflib/master"
source(file.path(.Rfliburl,"getRflib.R"),local = TRUE)
source(getRflib("is.defined.R"),local = TRUE)
source(getRflib("strCap.R"),local = TRUE)
# source(getRflib("myplclust.R"),local = TRUE)

library(data.table)
library(dplyr)
library(xts)
```
&nbsp;

#### Data Loading

Loading *raw* comma-delimited text file data set downloaded from Coursera course website into R workspace as data.table class object with naming of the data object derives from website data source programmatically, by-passing manual data staging as much as possible during loading phase.

```{r data.load}
# loading data downloaded from course website into R workspace 

# set data source url to course website
fileurl <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"
datadir <- paste(".", "data", sep = "/")
filetmp <- tempfile()
filenam <- character()

download.file(fileurl, filetmp)

if (!dir.exists(datadir)) {
        dir.create(datadir)
}

# extract source data file name as name of work data object in workspace 
filels <- strsplit(basename(fileurl), "%2F", fixed = TRUE)[[1]]
for (i in 1:length(filels)) {
        filein <- strsplit(filels[i], ".", fixed = TRUE)[[1]]
        if (length(filein) > 1) {
                filenam[i] <- filein[1]
                filesrc <- bzfile(filetmp, open = "r")
                assign(filenam[i], data.table(read.csv(filesrc)))
                flush(filesrc)
                # break 
        }
}
close(filesrc)

i <- which(!is.na(filenam))

# filenam <- "stormdata"
# filenam <- paste(datadir, filenam, sep = "/")
# filenam <- paste(filenam,"csv", "bz2", sep = ".")
# filesrc <- bzfile(filenam, open = "w")
# write.csv(StormData, filesrc, row.names = FALSE)
# close(filesrc)

unlink(filetmp)
rm(fileurl,filetmp,filesrc,filels,filein)
```
&nbsp;

#### Exploratory Data Analysis

```{r eda.0}
for (p in 1:length(i)) {
        print(paste(p, ":",filenam[i][p], "(",object.size(get(filenam[i][p]))/10e+05,"MB)"))
}
rm(p)
```
**`r length(i)`** *raw* data `r ifelse(length(i) > 1, "sets were", "set was")` extracted into R workspace from NOAA sourced data downloaded from course website. (number in bracket depicts memory footprint).

Structure of data object **`r filenam[i][1]`**.
```{r eda.1}
str(get(filenam[i][1]))
```
**`r length(names(get(filenam[i][1])))`** columns found in the *raw* data set **`r filenam[i][1]`**. 

For this data analysis work, we shall create a working data set called **stormdata** consisting 18 data columns grabbed from the *raw* data set **`r filenam[i][1]`**. (see attached list)
```{r eda.2}
v <- c(2,3,4,5,6,7,8,12,13,19,20,22,23,24,25,26,27,28) # column number
names(get(filenam[i][1]))[v]

stormdata <- get(filenam[i][p]) %>%
        select(names(.)[featls]) %>%
        mutate(DATE_TIME = )

```


```{r house.keeping}
detach("package:xts", unload = TRUE)
detach("package:dplyr", unload = TRUE)
detach("package:data.table", unload = TRUE)
```
